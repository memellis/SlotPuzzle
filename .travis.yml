env:
  global:
  - ANDROID_API_LEVEL=28
  - ANDROID_BUILD_TOOLS_VERSION=28.0.3
  - ANDROID_ABI=armeabi-v7a
git:
  submodules: false
before_install:
- openssl aes-256-cbc -K $encrypted_ad9f1e893abb_key -iv $encrypted_ad9f1e893abb_iv
  -in deploy_android_release.tar.enc -out deploy_android_release.tar -d
- ls -l
- tar xf deploy_android_release.tar
- chmod 400 deploy.rsa
- eval `ssh-agent -s`
- cat deploy.rsa | ssh-add -
- sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
- git submodule update --init --recursive
- touch $HOME/.android/repositories.cfg
- yes | sdkmanager "platforms;android-28"
- yes | sdkmanager "build-tools;28.0.3"
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
  - "$HOME/.android/build-cache"
language: android
android:
  components:
  - tools
  - platform-tools
  - tools
  licenses:
  - android-sdk-preview-license-52d11cd2
  - android-sdk-license-.+
  - google-gdk-license-.+
before_script: cd source/java/2d
script:
- keytool -genkey -v -keystore $HOME/.android/debug.keystore -storepass android -alias androiddebugkey -keypass android -keyalg RSA -keysize 2048 -validity 10000 -dname "C=US, O=Android, CN=Android Debug"
- "./gradlew clean"
- "./gradlew desktop:build"
- "./gradlew android:build"
- "./gradlew core:test jacocoTestReport"
- "./gradlew assembleRelease"
after_success:
- bash ${TRAVIS_BUILD_DIR}/.set_tags.sh
- bash <(curl -s https://codecov.io/bash)
deploy:
  skip_cleanup: true
  provider: releases
  api_key: 
    secure: "oN/usJUGWfX8UyRi9hUQjv16dId5lT2lNCO992zJIEk/wP+/oHhWvtERI18cc1WgnppPYhfAsbmDSXY95VNUrCwFYwrE6L93k2lPMGO9+poJxQMuN5EfaodMKZeKv+PhacjBKKnVNxFU/UbAqMKPobHzmTmv2anRjsjDjetGNppmglIEQRKRbL5iLpy6zzJGxDeCR7EuupmIod/FL5t2n8rGwudK8DoFJhODVZVYpeD5mJbkyJDT1DP4sVMhkVXqpi+lUVAiwzO0J9hKXvqaBiGpOFz6Nvhcb58TyCNg4nZQfKrcxglVKXbbWgcokdfbCkJxRhT3GatzuJ1GdHFWn9TMNpseC7ATf/+9Hdo8RKV7xGdpLCnZ1Th3SAomtva82pBBwGG7BVgFOVJpNTvUCEchdZPMbfRkmDcMTeXnun9l19cYdkWyWGStZNLXhJAJ3tF14AFhjzMY3GMPY9vhPiBnWO4H6IRTRVofafwoeBh064Iv94R2y0vt9UAvoNL2+Pj7XDan/L56IGd+zB1HD+vF2Bkp9Xx/4LXQeCdFMruFAi6bMGFc/UUCvIYUzKyfV7IqVzMoafLORnzfeqU7AtpurseTxcdM09wLw+dVQ7sHDrkU3l9QtPqXNakgnQC3pxXCq66s55jvYUzHvsL4G93YyCxvngEfqXT8bRdCuf8="
  file: "${TRAVIS_BUILD_DIR}/source/java/2d/android/build/outputs/apk/*/android-*.apk"   
  file_glob: true
  on:
    repo: memellis/SlotPuzzle
    tags: true
    branch: master 
