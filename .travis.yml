env:
  global:
  - ANDROID_API_LEVEL=28
  - ANDROID_BUILD_TOOLS_VERSION=28.0.3
  - ANDROID_ABI=armeabi-v7a
git:
  submodules: false
before_install:
- openssl aes-256-cbc -K $encrypted_ad9f1e893abb_key -iv $encrypted_ad9f1e893abb_iv
  -in deploy_android_release.tar.enc -out deploy_android_release.tar -d
- ls -l
- tar xf deploy_android_release.tar
- chmod 400 deploy.rsa
- eval `ssh-agent -s`
- cat deploy.rsa | ssh-add -
- sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
- git submodule update --init --recursive
- touch $HOME/.android/repositories.cfg
- yes | sdkmanager "platforms;android-28"
- yes | sdkmanager "build-tools;28.0.3"
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
  - "$HOME/.android/build-cache"
language: android
android:
  components:
  - tools
  - platform-tools
  - tools
  licenses:
  - android-sdk-preview-license-52d11cd2
  - android-sdk-license-.+
  - google-gdk-license-.+
before_script: cd source/java/2d
script:
- keytool -genkey -v -keystore $HOME/.android/debug.keystore -storepass android -alias androiddebugkey -keypass android -keyalg RSA -keysize 2048 -validity 10000 -dname "C=US, O=Android, CN=Android Debug"
- "./gradlew clean"
- "./gradlew desktop:build"
- "./gradlew android:build"
- "./gradlew core:test jacocoTestReport"
- "./gradlew assembleRelease"
after_success:
- bash ${TRAVIS_BUILD_DIR}/.set_tags.sh
- bash <(curl -s https://codecov.io/bash)
deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: "QXjEtUlywk+nCj8+jdMsOony6wy56kpmFb2JHbW+GnW66ohxVVqJy7nxK4doj9/M2bcoSaQHtE23byicCrTTDYZK4o7GgiNfkTzRtWTlimxZDUu3Ir2u/ajdn4lluydmhBNQ16coj5EKsomx9PSjHIUfqCP642NlVKsdTso9N+D9wfW61SvAbbLxp+0ebgXOb9XO3PPOu/4S6SehCeSb1HHls1vI4xLpROd0FmV0BnmGSJ8xMnH4PVz155bhO/WCcn/vIDEmnV9hYWIs435xRu3BnKP3SqLdMvLyUscizdIIeC4J+LL8i6a2GwTg5knsLMCXUDCygpyAl53Tv0jSy5EXMzq8IfglCg7qtKmIgQBEmIdTd31VexYgBSVzXkmAXDZCF8brM/ek6jqcli0cxOJ7x0ijNd5vGRpA4ukpdwZt0K5pDLz0QL7uMDv2eifLMR9Ea6NYEH0aOQ4GcK08VVijG+fhp110EGrHGg7DdP5bTGFwA3Msc++ODkIDdzS8C39G8J0EOWNWszgO6MFNv/O2f7qrypOQ+odJ7lYzFbP3gGGt3RbdlSABJNUnBSlUKRj1D4qKD30c+M0MKlFPcrGY1pax+1fAZJDjrMmND63D7NtrXl6E8l5cS8eVmJ8xy6fnZZWOJ1RCcQEYboK4YqgijA4l9DQj0rL8AiCVLfQ="
  file: "${TRAVIS_BUILD_DIR}/source/java/2d/android/build/outputs/apk/*/android-*.apk"   
  file_glob: true
  on:
    repo: memellis/SlotPuzzle
    tags: true
    branch: master 
